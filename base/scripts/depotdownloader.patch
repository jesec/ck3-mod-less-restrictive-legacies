diff --git a/DepotDownloader/ConsoleAuthenticator.cs b/DepotDownloader/ConsoleAuthenticator.cs
index 8151340..e19b149 100644
--- a/DepotDownloader/ConsoleAuthenticator.cs
+++ b/DepotDownloader/ConsoleAuthenticator.cs
@@ -13,6 +13,13 @@ namespace DepotDownloader
         /// <inheritdoc />
         public Task<string> GetDeviceCodeAsync(bool previousCodeWasIncorrect)
         {
+            // If a 2FA code was provided via CLI/env var, use it on first attempt
+            if (!previousCodeWasIncorrect && !string.IsNullOrEmpty(ContentDownloader.Config.TwoFactorCode))
+            {
+                Console.WriteLine($"Using provided 2FA code.");
+                return Task.FromResult(ContentDownloader.Config.TwoFactorCode);
+            }
+
             if (previousCodeWasIncorrect)
             {
                 Console.Error.WriteLine("The previous 2-factor auth code you have provided is incorrect.");
@@ -38,6 +45,13 @@ namespace DepotDownloader
         /// <inheritdoc />
         public Task<string> GetEmailCodeAsync(string email, bool previousCodeWasIncorrect)
         {
+            // If a 2FA code was provided via CLI/env var, use it on first attempt
+            if (!previousCodeWasIncorrect && !string.IsNullOrEmpty(ContentDownloader.Config.TwoFactorCode))
+            {
+                Console.WriteLine($"Using provided auth code for email {email}.");
+                return Task.FromResult(ContentDownloader.Config.TwoFactorCode);
+            }
+
             if (previousCodeWasIncorrect)
             {
                 Console.Error.WriteLine("The previous 2-factor auth code you have provided is incorrect.");
diff --git a/DepotDownloader/ContentDownloader.cs b/DepotDownloader/ContentDownloader.cs
index a59a69f..b1cebd2 100644
--- a/DepotDownloader/ContentDownloader.cs
+++ b/DepotDownloader/ContentDownloader.cs
@@ -618,9 +618,8 @@ namespace DepotDownloader
                 manifestId = await GetSteam3DepotManifest(depotId, appId, branch);
                 if (manifestId == INVALID_MANIFEST_ID && !string.Equals(branch, DEFAULT_BRANCH, StringComparison.OrdinalIgnoreCase))
                 {
-                    Console.WriteLine("Warning: Depot {0} does not have branch named \"{1}\". Trying {2} branch.", depotId, branch, DEFAULT_BRANCH);
-                    branch = DEFAULT_BRANCH;
-                    manifestId = await GetSteam3DepotManifest(depotId, appId, branch);
+                    Console.WriteLine("Warning: Depot {0} does not have branch named \"{1}\". Skipping depot.", depotId, branch);
+                    return null;
                 }
 
                 if (manifestId == INVALID_MANIFEST_ID)
diff --git a/DepotDownloader/DownloadConfig.cs b/DepotDownloader/DownloadConfig.cs
index 144853b..857d516 100644
--- a/DepotDownloader/DownloadConfig.cs
+++ b/DepotDownloader/DownloadConfig.cs
@@ -32,5 +32,6 @@ namespace DepotDownloader
 
         public bool UseQrCode { get; set; }
         public bool SkipAppConfirmation { get; set; }
+        public string TwoFactorCode { get; set; }
     }
 }
diff --git a/DepotDownloader/Program.cs b/DepotDownloader/Program.cs
index 26b7f16..6dd62a1 100644
--- a/DepotDownloader/Program.cs
+++ b/DepotDownloader/Program.cs
@@ -64,11 +64,12 @@ namespace DepotDownloader
                 var httpEventListener = new HttpDiagnosticEventListener();
             }
 
-            var username = GetParameter<string>(args, "-username") ?? GetParameter<string>(args, "-user");
-            var password = GetParameter<string>(args, "-password") ?? GetParameter<string>(args, "-pass");
+            var username = GetParameter<string>(args, "-username") ?? GetParameter<string>(args, "-user") ?? Environment.GetEnvironmentVariable("STEAM_USERNAME");
+            var password = GetParameter<string>(args, "-password") ?? GetParameter<string>(args, "-pass") ?? Environment.GetEnvironmentVariable("STEAM_PASSWORD");
             ContentDownloader.Config.RememberPassword = HasParameter(args, "-remember-password");
             ContentDownloader.Config.UseQrCode = HasParameter(args, "-qr");
             ContentDownloader.Config.SkipAppConfirmation = HasParameter(args, "-no-mobile");
+            ContentDownloader.Config.TwoFactorCode = GetParameter<string>(args, "-2fa") ?? Environment.GetEnvironmentVariable("STEAM_2FA_CODE");
 
             if (username == null)
             {
@@ -513,11 +514,15 @@ namespace DepotDownloader
             Console.WriteLine("  -pubfile <#>             - the PublishedFileId to download. (Will automatically resolve to UGC id)");
             Console.WriteLine();
             Console.WriteLine("  -username <user>         - the username of the account to login to for restricted content.");
+            Console.WriteLine("                             Can also use STEAM_USERNAME environment variable.");
             Console.WriteLine("  -password <pass>         - the password of the account to login to for restricted content.");
+            Console.WriteLine("                             Can also use STEAM_PASSWORD environment variable.");
             Console.WriteLine("  -remember-password       - if set, remember the password for subsequent logins of this user.");
             Console.WriteLine("                             use -username <username> -remember-password as login credentials.");
             Console.WriteLine("  -qr                      - display a login QR code to be scanned with the Steam mobile app");
             Console.WriteLine("  -no-mobile               - prefer entering a 2FA code instead of prompting to accept in the Steam mobile app");
+            Console.WriteLine("  -2fa <code>              - provide 2FA code upfront (for automation with TOTP generators).");
+            Console.WriteLine("                             Can also use STEAM_2FA_CODE environment variable.");
             Console.WriteLine();
             Console.WriteLine("  -dir <installdir>        - the directory in which to place downloaded files.");
             Console.WriteLine("  -filelist <file.txt>     - the name of a local file that contains a list of files to download (from the manifest).");
